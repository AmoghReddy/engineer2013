function page(e,t,n){this.name;this.pageElement=e;this.pageRect=e.getBoundingClientRect();this.pageTween;this.DOMobjects=[];this.targets={page:[],sphere:[],helix:[],grid:[],initial:[]};this.WGLobjects=[];this.initialPositions=[];this.zDepth;this.onComplete=function(){};this.initPage=function(){this.name=e.id.substr(4);getAllChildren(this.pageElement,REblock,this.DOMobjects);getPageTargets(this.DOMobjects,this.targets.page,this.initialPositions,this.pageElement,t,n);loadWGLObjects(this.DOMobjects,this.WGLobjects)};this.initTabs=function(){this.name=e.id.substr(4);getAllChildren(this.pageElement,REcomittee,this.DOMobjects);getComitteeTargets(this.DOMobjects,this.targets.page,200,this);loadWGLObjects(this.DOMobjects,this.WGLobjects)};this.initComittee=function(){this.name=e.id;getAllChildren(this.pageElement,REcomittee,this.DOMobjects);getComitteeTargets(this.DOMobjects,this.targets.page,200,this);loadWGLObjects(this.DOMobjects,this.WGLobjects)};this.initHome=function(){this.name=e.id;var t=-20,n=1200;this.zDepth=t;this.DOMobjects.push(document.getElementById("engiLogo"));getAllChildren(this.pageElement,REmenu,this.DOMobjects);getHomeTargets(this.DOMobjects,this.targets.page,t);loadWGLObjects(this.DOMobjects,this.WGLobjects);this.onComplete=function(){TWEEN.remove(renderTween);var e=this.name;if(allPages[e].pageTween!=undefined){TWEEN.remove(allPages[e].pageTween)}var t=allPages[e].zDepth;var r={theta:0},i={theta:2*Math.PI};this.pageTween=(new TWEEN.Tween(r)).to({theta:i.theta},n).onUpdate(function(){for(var n=1;n<allPages[e].WGLobjects.length;n++){var r=allPages[e].WGLobjects[n];r.position.z=t*Math.sin(2*Math.PI*(n-1)/(allPages[e].WGLobjects.length-1)+this.theta)}}).repeat(Infinity).start();renderTween=(new TWEEN.Tween(this)).to({},n).onUpdate(render).repeat(Infinity).start()}}}function position(e,t,n){this.x=e;this.y=t;this.z=n}function getAllChildren(e,t,n){if(e.id==undefined)return null;if(e.hasChildNodes()){var r=e.childNodes;for(x in r){if(r[x].id==undefined)continue;if(t.test(r[x].id)){n.push(r[x])}else if(r[x].hasChildNodes()){getAllChildren(r[x],t,n)}}}}function lookAwayFrom(e,t){var n=new THREE.Vector3;e.position.x-=t.x;e.position.y-=t.y;e.position.z-=t.z;n.copy(e.position).multiplyScalar(2);e.lookAt(n);e.position.x+=t.x;e.position.y+=t.y;e.position.z+=t.z}function getPageTargets(e,t,n,r,i,s){var o,u,a,f,l,c,h,p;var d=new THREE.Vector3;d.copy(pivot);var v=r.getBoundingClientRect();var m=v.top-headerLength;var g=(initialWidth-(v.right-v.left))/2;if(i)g=0;for(var y=0;y<e.length;y++){o=e[y].getBoundingClientRect();u=new THREE.Object3D;a=o.left+g;f=o.top-m;l=o.right-o.left;c=o.bottom-o.top;u.position.x=a-initialWidth/2+l/2;u.position.y=window.innerHeight/2-f-c/2;p=new position(u.position.x,u.position.y,0);n.push(p);d.x=u.position.x;h=u.position.y/d.z;u.position.y=d.z*Math.sin(h);u.position.z=d.z-d.z*Math.cos(h)+s;lookAwayFrom(u,d);t.push(u)}}function getTabTargets(e,t,n,r,i,s,o){var u,a,f,l,c,h,p,d;var v=new THREE.Vector3;v.copy(pivot);var m=r.getBoundingClientRect();var g=m.top-headerLength;var y=(initialWidth-(m.right-m.left))/2;if(i)y=0;for(var b=0;b<e.length;b++){u=e[b].getBoundingClientRect();a=new THREE.Object3D;f=u.left+y;l=u.top-g;c=u.right-u.left;h=u.bottom-u.top;a.position.x=f-initialWidth/2+c/2;a.position.y=window.innerHeight/2-l-h/2;d=new position(a.position.x,a.position.y,0);n.push(d);v.x=a.position.x;p=a.position.y/v.z;a.position.y=v.z*Math.sin(p);a.position.z=v.z-v.z*Math.cos(p)+s;lookAwayFrom(a,v);t.push(a)}}function getNextScroll(e,t,n,r){var i=new THREE.Vector3;i.copy(pivot);var s,o,u;for(var a=0;a<e.length;a++){s=new THREE.Object3D;i.x=e[a].position.x;u=t[a].y/i.z+r;s.position.x=e[a].position.x;s.position.y=i.z*Math.sin(u);s.position.z=i.z-i.z*Math.cos(u);lookAwayFrom(s,i);n.push(s)}}function getNextRevolution(e,t,n,r){var i,s;var o=new THREE.Vector3;o.copy(camera.position);o.z+=1500;for(var u=0;u<e.length;u++){i=new THREE.Object3D;s=Math.atan2(e[u].position.x,e[u].position.z-r)+n;radius=Math.sqrt(Math.pow(e[u].position.x,2)+Math.pow(e[u].position.z-r,2));i.position.x=radius*Math.sin(s);i.position.z=radius*Math.cos(s)+r;i.position.y=e[u].position.y;o.y=i.position.y;i.lookAt(o);t.push(i)}}function getSphereTargets(e,t,n){var r=new THREE.Vector3;r.copy(camera.position);var i,s,o;for(var u=0,a=e.length;u<a;u++){i=Math.acos(-1+2*u/a);s=Math.sqrt(a*Math.PI)*i;o=new THREE.Object3D;o.position.y=n*Math.sin(s)*Math.sin(i);o.position.x=n*Math.cos(s)*Math.sin(i);o.position.z=n*Math.cos(i);r.copy(o.position).multiplyScalar(2);o.lookAt(r);t.push(o)}}function getHelixTargets(e,t,n){var r=new THREE.Vector3;var i,s;for(var o=0,u=e.length;o<u;o++){var i=o*.175+Math.PI;s=new THREE.Object3D;s.position.x=n*Math.sin(i);s.position.y=-(o*8)+450;s.position.z=n*Math.cos(i);r.copy(s.position);r.x*=2;r.z*=2;s.lookAt(r);t.push(s)}}function getGridTargets(e,t){var n;for(var r=0;r<e.length;r++){n=new THREE.Object3D;n.position.x=r%5*400-800;n.position.y=-(Math.floor(r/5)%5)*400+800;n.position.z=Math.floor(r/25)*1e3-2e3;t.push(n)}}function getComitteeTargetsOld(e,t,n,r){var i,s,o,u,a,f,l,c,h,p,d,v;i=s=o=Math.floor(e.length/3);if(e.length%3==1){s++}else if(e.length%3==2){i++;o++}p=d=v=f=0;for(var m=0;m<i;m++){var g=e[m].getBoundingClientRect();f+=g.right-g.left+n;if(g.bottom-g.top>p)p=g.bottom-g.top}l=f/(2*Math.PI);f=0;for(var m=i;m<i+s;m++){var g=e[m].getBoundingClientRect();f+=g.right-g.left+n;if(g.bottom-g.top>d)d=g.bottom-g.top}c=f/(2*Math.PI);f=0;for(var m=i+s;m<i+s+o;m++){var g=e[m].getBoundingClientRect();f+=g.right-g.left+n;if(g.bottom-g.top>v)v=g.bottom-g.top}h=f/(2*Math.PI);a=2*Math.PI/i;for(var m=0;m<i;m++){u=new THREE.Object3D;u.position.x=l*Math.sin(m*a);u.position.y=(p+d)/2;u.position.z=l*Math.cos(m*a)+r;t.push(u)}a=2*Math.PI/s;for(var m=0;m<s;m++){u=new THREE.Object3D;u.position.x=c*Math.sin(Math.PI/4+m*a);u.position.y=0;u.position.z=c*Math.cos(Math.PI/4+m*a)+r;t.push(u)}a=2*Math.PI/o;for(var m=0;m<o;m++){u=new THREE.Object3D;u.position.x=h*Math.sin(m*a);u.position.y=-(v+d)/2;u.position.z=h*Math.cos(m*a)+r;t.push(u)}}function getComitteeTargets(e,t,n,r){var i,s,o,u,a,f,l,c,h;var p=new THREE.Vector3;p.copy(camera.position);p.z+=1500;i=s=Math.floor(e.length/2);if(e.length%2==1){s++}c=h=a=0;for(var d=0;d<i;d++){var v=e[d].getBoundingClientRect();a+=v.right-v.left+n;if(v.bottom-v.top>c)c=v.bottom-v.top}f=a/(2*Math.PI);a=0;for(var d=i;d<i+s;d++){var v=e[d].getBoundingClientRect();a+=v.right-v.left+n;if(v.bottom-v.top>h)h=v.bottom-v.top}l=a/(2*Math.PI);console.log("height = "+(c+h));var m=camera.position.z-(c+h+headerLength+footerLength)/(2*Math.tan(Math.PI/180*cameraAngle/2))-l;r.zDepth=m;u=2*Math.PI/i;for(var d=0;d<i;d++){o=new THREE.Object3D;o.position.x=f*Math.sin(d*u);o.position.y=c/2;o.position.z=f*Math.cos(d*u)+m;p.y=o.position.y;o.lookAt(p);t.push(o)}u=2*Math.PI/s;for(var d=0;d<s;d++){o=new THREE.Object3D;o.position.x=l*Math.sin(Math.PI+d*u);o.position.y=-h/2;o.position.z=l*Math.cos(Math.PI+d*u)+m;p.y=o.position.y;o.lookAt(p);t.push(o)}}function getHomeTargets(e,t,n){var r,i,s,o,u,a;i=0;for(var f=1;f<e.length;f++){s=e[f].getBoundingClientRect();o=Math.sqrt(Math.pow(s.right-s.left,2)+Math.pow(s.bottom-s.top,2))/2;if(o>i)i=o}i-=100;s=e[0].getBoundingClientRect();r=Math.sqrt(Math.pow(s.right-s.left,2)+Math.pow(s.bottom-s.top,2))/2+i;console.log(r);u=2*Math.PI/(e.length-1);a=new THREE.Object3D(0,0,0);t.push(a);for(var f=1;f<e.length;f++){a=new THREE.Object3D;a.position.x=r*Math.cos((f-1)*u);a.position.y=r*Math.sin((f-1)*u);a.position.z=n*Math.sin(2*Math.PI*(f-1)/(e.length-1));t.push(a)}}function getRandomTarget(e){e.position.z=(Math.random()*5e3+100)*Math.pow(-1,Math.floor(Math.random()*100));var t=(camera.position.z-e.position.z)*Math.tan(Math.PI/180*cameraAngle/2);e.position.y=(Math.random()*2e3+t+window.innerHeight/2)*Math.pow(-1,Math.floor(Math.random()*100));e.position.x=(Math.random()*2e3+t*(window.innerWidth/window.innerHeight)+window.innerWidth/2)*Math.pow(-1,Math.floor(Math.random()*100));e.rotation.x=Math.random()%Math.PI*2;e.rotation.y=Math.random()%Math.PI*2;e.rotation.z=Math.random()%Math.PI*2}function loadWGLObjects(e,t){var n;for(var r=0;r<e.length;r++){n=new THREE.CSS3DObject(e[r]);getRandomTarget(n);t.push(n)}}function unloadPage(e){for(var t=0;t<e.length;t++){scene.remove(e[t])}}function loadPage(e){if(e==undefined)return;for(var t=0;t<e.WGLobjects.length;t++){scene.add(e.WGLobjects[t])}}function explodePage(e){if(e==undefined)return;var t;var n=[];for(var r=0;r<e.WGLobjects.length;r++){t=new THREE.Object3D;getRandomTarget(t);n.push(t)}transform(e.WGLobjects,n,3e3,0,true,e)}function explodeTabbedPage(e){if(e==undefined)return;for(x in e){explodePage(e[x])}}function getPage(e,t){alpha=0;var n=2500,r=2500;explodePage(currentPage);explodePage(currentSideBar);explodeTabbedPage(currentTabbedPage);currentPage=allPages[e];currentSideBar=allSideBars[e];currentTabbedPage=undefined;if(t!=undefined){currentTabbedPage=allTabbedPages[e];currentPage=allTabbedPages[e][t];for(x in allTabbedPages[e]){var i=allTabbedPages[e][x];loadPage(i);transform(i.WGLobjects,i.targets.page,n,r,false,i)}var s=[];getNextScroll(currentPage.targets.page,currentPage.initialPositions,s,alpha);transform(currentPage.WGLobjects,s,n,r,false,currentPage)}else{loadPage(currentPage);if(currentPage.name=="homePage")r=0;transform(currentPage.WGLobjects,currentPage.targets.page,n,r,false,currentPage)}if(currentSideBar!=undefined){loadPage(currentSideBar);transform(currentSideBar.WGLobjects,currentSideBar.targets.page,n,r,false,currentSideBar)}if(t==undefined){addHistory(currentPage.name);if(currentPage.name=="homePage")$("#menu").fadeOut();else $("#menu").fadeIn()}}function getNextPage(){curIndex++;if(curIndex>=allPagesIndex.length)curIndex=0;getPage(allPagesIndex[curIndex])}function getPrevPage(){curIndex--;if(curIndex<0)curIndex=allPagesIndex.length-1;getPage(allPagesIndex[curIndex])}function initPages(){var e=[];var t;getAllChildren(container,REpage,e);for(var n=0;n<e.length;n++){t=new page(e[n],true,0);t.initPage();allPagesIndex.push(t.name);allPages[t.name]=t}}function initTabbedPages(){var e=[];var t=[];var n,r=-300;getAllChildren(container,REtabgroup,e);for(var i=0;i<e.length;i++){getAllChildren(e[i],REtabs,t);var s=e[i].id.substr(8);allTabbedPages[s]={};for(var o=0;o<t.length;o++){n=new page(t[o],true,(o+1)*r);n.initPage();allTabbedPages[s][n.name]=n}}}function initSideBars(){var e=[];var t;getAllChildren(container,REside,e);for(var n=0;n<e.length;n++){t=new page(e[n],true,0);t.initPage();allSideBars[t.name]=t}}function initForms(){var e=[];var t;getAllChildren(container,REform,e);for(var n=0;n<e.length;n++){t=new page(e[n],false,300);t.initPage();allForms[t.name]=t}}function initAllCommittees(){var e=document.getElementById("allCommittees");var t=new page(e,false,0);t.initComittee();allPagesIndex.push(t.name);allPages[t.name]=t}function initHomePage(){var e=document.getElementById("homePage");var t=new page(e,false,0);t.initHome();allPagesIndex.push(t.name);allPages[t.name]=t}function setCameraZ(){camera.position.z=window.innerHeight/(2*Math.tan(Math.PI/180*(cameraAngle/2)))*(initialWidth/window.innerWidth)}function init(){container=document.getElementById("container");cameraAngle=65;camera=new THREE.PerspectiveCamera(cameraAngle,window.innerWidth/window.innerHeight,1,5e3);setCameraZ();scene=new THREE.Scene;initPages();initSideBars();initTabbedPages();initForms();initAllCommittees();initHomePage();renderer=new THREE.CSS3DRenderer;renderer.setSize(window.innerWidth,window.innerHeight);renderer.domElement.style.position="absolute";container.innerHTML="";container.appendChild(renderer.domElement)}function transform(e,t,n,r,i,s){TWEEN.remove(renderTween);if(s.pageTween!=undefined){TWEEN.remove(s.pageTween)}for(var o=0;o<e.length;o++){var u=e[o];var a=t[o];if(allTweens[u.id]!=undefined){TWEEN.remove(allTweens[u.id][0]);TWEEN.remove(allTweens[u.id][1]);TWEEN.remove(allTweens[u.id][2])}var f=(new TWEEN.Tween(u.position)).to({x:a.position.x,y:a.position.y,z:a.position.z},Math.random()*r+n).easing(TWEEN.Easing.Elastic.Out).start();var l=(new TWEEN.Tween(u.rotation)).to({x:a.rotation.x,y:a.rotation.y,z:a.rotation.z},Math.random()*r+n).easing(TWEEN.Easing.Exponential.InOut).start();var c=(new TWEEN.Tween(u)).to({},n+r).onComplete(function(){if(i==true)scene.remove(this)}).start();allTweens[u.id]=[f,l,c]}renderTween=(new TWEEN.Tween(this)).to({},n+r).onUpdate(render).start();(new TWEEN.Tween(this)).to({},n+r).onComplete(function(){if(s!=undefined){s.onComplete()}}).start()}function onWindowResize(){camera.aspect=window.innerWidth/window.innerHeight;camera.updateProjectionMatrix();setCameraZ();renderer.setSize(window.innerWidth,window.innerHeight)}function animate(){requestAnimationFrame(animate);TWEEN.update()}function render(){renderer.render(scene,camera)}function start(){setEvents();init();animate()}function addHistory(e){if(history[history.length-1]!=e)history.push(e);document.getElementById("share_url").value=window.location.href.split("#")[0]+"#"+e}function backHistory(){itemName=history.pop();getPage(history[history.length-1])}var camera,cameraAngle,scene,renderer;var container,controls;var headerLength=10;var footerLength=60;var initialWidth=1366;var allForms={};var allSideBars={};var allTabbedPages={};var allPages={};var allPagesIndex=[];var allTweens={};var currentPage;var currentTabbedPage;var currentSideBar;var currentForm;var renderTween;var REblock=new RegExp("^block");var REpage=new RegExp("^page");var REside=new RegExp("^side");var REform=new RegExp("^form");var REcomittee=new RegExp("^comittee");var REmenu=new RegExp("^menu");var REtabgroup=new RegExp("^tabgroup");var REtabs=new RegExp("^tabs");var pivot=new THREE.Vector3(0,0,-3e3);var history=[];var curIndex=0